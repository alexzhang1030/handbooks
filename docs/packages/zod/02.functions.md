# Zod å¸¸ç”¨æ–¹æ³•

## parse ç³»åˆ—

ç›®å‰æœ‰å‡ ç§ `parse` æ–¹æ³•ï¼š

- `parse`
- `parseAsync`
- `safeParse`
- `safeParseAsync`

ä¸¤ç§å¤§ç±»ï¼š

- `parse`: è‹¥ input ä¸ç¬¦åˆ schemaï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸
- `safeParse`: è‹¥ input ä¸ç¬¦åˆ schemaï¼Œåˆ™ä¼šè¿”å› `SafeParseError`ï¼ŒåŒ…å« `success` å’Œ `error` ä¸¤ä¸ªå­—æ®µ

Examples:

```ts
const schema = z.object({
  name: z.string()
})

const user = schema.parse({ name: 1 }) // throw error!
const safeParseResult = schema.safeParse({ name: 1 })
// safeParseResult:
// if success: { success: true, data: user }
// else { success: false, error: ZodError }
```

## coerce

coerce å¯ä»¥ç†è§£ä¸ºæ•°æ®ç±»å‹ä¹‹é—´çš„å¼ºåˆ¶è½¬æ¢ï¼Œåœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°ï¼š

- number <-> string
- date <-> string

coerce æ”¯æŒä»¥ä¸‹å‡ ç§ç±»å‹ï¼š

- `string`
- `number`
- `bigint`
- `boolean`
- `date`

Examples: 

string -> number 

```ts
const toInt = z.coerce.number()
toInt.parse('123') // 123
```

number -> date 

```ts
const toDate = z.coerce.date()
toDate.parse(+new Date())
```

å…·ä½“çš„[è½¬æ¢è§„åˆ™](https://zod.dev/?id=coercion-for-primitives)å¦‚ä¸‹ï¼š

```ts
z.coerce.string() // String(input)
z.coerce.number() // Number(input)
z.coerce.boolean() // Boolean(input)
z.coerce.bigint() // BigInt(input)
z.coerce.date() // new Date(input)
```

Boolean è½¬æ¢ï¼š

```ts
z.coerce.boolean().parse('tuna') // => true
z.coerce.boolean().parse('true') // => true
z.coerce.boolean().parse('false') // => true
z.coerce.boolean().parse(1) // => true
z.coerce.boolean().parse([]) // => true

z.coerce.boolean().parse(0) // => false
z.coerce.boolean().parse(undefined) // => false
z.coerce.boolean().parse(null) // => false
```

## refine

é€šè¿‡ `refine` æ¥è‡ªå®šä¹‰æ ¡éªŒè§„åˆ™

refine æ¥æ”¶ä¸¤ä¸ª[å‚æ•°](https://zod.dev/?id=arguments):

- `check`: æ ¡éªŒå‡½æ•°ï¼Œè¿”å› `boolean`/`Promise<boolean>`
- `message`: æ ¡éªŒå¤±è´¥æ—¶çš„æç¤ºä¿¡æ¯ï¼Œç±»å‹ä¸º `string | CustomErrorParams | ((arg: Output) => CustomErrorParams)`

Examples:

```ts
const addressSchema = z.string().refine(val => val.length < 20, {
  message: 'Address must be less than 20 characters'
})

const address = addressSchema.parse('12345678901234567890') // throws error
```

[`superRefine`](https://zod.dev/?id=superrefine) æä¾›äº†æ¯” `refine` æ›´å¤šçš„é…ç½®ï¼š

Examples:

```ts
const Strings = z.array(z.string()).superRefine((val, ctx) => {
  if (val.length > 3) {
    ctx.addIssue({
      code: z.ZodIssueCode.too_big,
      maximum: 3,
      type: 'array',
      inclusive: true,
      message: 'Too many items ğŸ˜¡',
    })
  }

  if (val.length !== new Set(val).size) {
    ctx.addIssue({
      code: z.ZodIssueCode.custom,
      message: 'No duplicates allowed.',
    })
  }
})
```

å¯ä»¥é€šè¿‡ `ctx.addIssue` æ¥æ·»åŠ é—®é¢˜ï¼Œå¦‚æœåœ¨æ ¡éªŒè¿‡ç¨‹ä¸­æ­¤æ–¹æ³•æ²¡æœ‰è¢«è°ƒç”¨ï¼Œåˆ™è¯´æ˜æ ¡éªŒé€šè¿‡ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œæ•´ä¸ªæ ¡éªŒè¿‡ç¨‹ä¸ä¼šåœæ­¢ï¼Œå¦‚æœéœ€è¦æå‰åœæ­¢æ ¡éªŒï¼Œå¯ä»¥é€šè¿‡ `return Z.never` æ¥å®ç°ï¼š

Examples:

```ts
const schema = z.number().superRefine((val, ctx) => {
  if (val < 10) {
    ctx.addIssue({
      code: z.ZodIssueCode.custom,
      message: 'should be >= 10',
      fatal: true,
    })

    return z.NEVER
  }

  if (val !== 12) {
    ctx.addIssue({
      code: z.ZodIssueCode.custom,
      message: 'should be twelve',
    })
  }
})
```

æé«˜ç±»å‹æ¨å¯¼ï¼š

Examples:

```ts
const schema = z
  .object({
    first: z.string(),
    second: z.number(),
  })
  .nullable()
  .superRefine((arg, ctx): arg is { first: string; second: number } => {
    if (!arg) {
      ctx.addIssue({
        code: z.ZodIssueCode.custom, // customize your issue
        message: 'object should exist',
      })
    }

    return z.NEVER // The return value is not used, but we need to return something to satisfy the typing
  })
  // here, TS knows that arg is not null
  .refine(arg => arg.first === 'bob', '`first` is not `bob`!')
```